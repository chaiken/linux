// SPDX-License-Identifier: (GPL-2.0-or-later OR MIT)
/*
 * Copyright 2022 NXP
 */

/dts-v1/;

#include <dt-bindings/usb/pd.h>
#include <dt-bindings/leds/common.h>
#include "imx93.dtsi"

#define DSI 8 // 10 = sn65, 8 = no sn65
// #define LVDS

#if defined(DSI) && defined(LVDS)
#error Only DSI OR LVDS may be defined
#endif


&ele_mu {
	memory-region = <&ele_reserved>;
};

/ {
	model = "Boundary NXP i.MX93 SMARC Board";
	compatible = "fsl,imx93-bd-smarc", "fsl,imx93-9x9-qsb", "fsl,imx93";

	chosen {
		stdout-path = &lpuart1;
	};

        aliases {
		rtc0 = &rv3028;
		rtc1 = &bbnsm_rtc;
        };

	reserved-memory {
		#address-cells = <2>;
		#size-cells = <2>;
		ranges;

		linux,cma {
			compatible = "shared-dma-pool";
			reusable;
			alloc-ranges = <0 0x80000000 0 0x40000000>;
			size = <0 0x10000000>;
			linux,cma-default;
		};

#if 0
		ethosu_mem: ethosu_region@C0000000 {
			compatible = "shared-dma-pool";
			reusable;
			reg = <0x0 0xC0000000 0x0 0x10000000>;
		};
#endif
		vdev0vring0: vdev0vring0@a4000000 {
			reg = <0 0xa4000000 0 0x8000>;
			no-map;
		};

		vdev0vring1: vdev0vring1@a4008000 {
			reg = <0 0xa4008000 0 0x8000>;
			no-map;
		};

		vdev1vring0: vdev1vring0@a4000000 {
			reg = <0 0xa4010000 0 0x8000>;
			no-map;
		};

		vdev1vring1: vdev1vring1@a4018000 {
			reg = <0 0xa4018000 0 0x8000>;
			no-map;
		};

		rsc_table: rsc-table@2021f000 {
			reg = <0 0x2021f000 0 0x1000>;
			no-map;
		};

		vdevbuffer: vdevbuffer@a4020000 {
			compatible = "shared-dma-pool";
			reg = <0 0xa4020000 0 0x100000>;
			no-map;
		};

		ele_reserved: ele-reserved@a4120000 {
			compatible = "shared-dma-pool";
			reg = <0 0xa4120000 0 0x100000>;
			no-map;
		};

	};

	cm33: imx93-cm33 {
		compatible = "fsl,imx93-cm33";
		mbox-names = "tx", "rx", "rxdb";
		mboxes = <&mu1 0 1
			  &mu1 1 1
			  &mu1 3 1>;
		memory-region = <&vdevbuffer>, <&vdev0vring0>, <&vdev0vring1>,
				<&vdev1vring0>, <&vdev1vring1>, <&rsc_table>;
		fsl,startup-delay-ms = <500>;
	};

#if 0
	ethosu {
		compatible = "arm,ethosu";
		fsl,cm33-proc = <&cm33>;
		memory-region = <&ethosu_mem>;
		power-domains = <&mlmix>;
	};
#endif

#if 1
	led-controller {
		compatible = "pwm-leds";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_leds>;

		led-1 {
			label = "tpm1_chan2";
			pwms = <&tpm1 2 42 0>; /* 42 = 24MHz; 30000 = 33KHz */
			max-brightness = <10>;
		};

	};
#endif

	sai1_pwm_mclk: sai1-mclk {
                compatible = "pwm-clock";
                #clock-cells = <0>;
                clock-frequency = <24000000>;
                clock-output-names = "sai1_pwm_mclk";
                pwms = <&tpm3 3 42 0>; /* 1 / 42 ns = 24 MHz */
        };

#ifdef DSI
	dsi_backlight: dsi-backlight {
                brightness-levels = <0 1 2 3 4 5 6 7 8 9 10>;
                compatible = "pwm-backlight";
                default-brightness-level = <8>;
                display = <&lcdif>;
                pinctrl-names = "default";
                pinctrl-0 = <&pinctrl_backlight_0>;
                pwms = <&tpm5 3 30000 0>;       /* 42 = 24MHz  30000 = 3.3 Khz */
                status = "okay";
        };
#endif

#ifdef LVDS
	lvds_backlight: lvds_backlight {
		brightness-levels = <0 1 2 3 4 5 6 7 8 9 10>;
                compatible = "pwm-backlight";
                default-brightness-level = <8>;
                display = <&lcdif>;
                pinctrl-names = "default";
                pinctrl-0 = <&pinctrl_backlight_1>;
                pwms = <&tpm6 1 30000 0>;       /* 33.3 Khz */
                status = "okay";
        };

#if 1
	lvds_panel {
                compatible = "tianma,tm070jdhg30";
                backlight = <&lvds_backlight>;

                port {
                        panel_lvds_in: endpoint {
                                remote-endpoint = <&lvds_out>;
                        };
                };
        };
#endif
#endif

	reg_usdhc2_vmmc: regulator-usdhc2 {
		compatible = "regulator-fixed";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_reg_usdhc2_vmmc>;
		regulator-name = "VSD_3V3";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		gpio = <&gpio3 7 GPIO_ACTIVE_HIGH>;
		off-on-delay-us = <12000>;
		enable-active-high;
	};

	reg_vref_5v0: regulator-5v0 {
                compatible = "regulator-fixed";
                regulator-name = "VDD_5V0";
                regulator-min-microvolt = <5000000>;
                regulator-max-microvolt = <5000000>;
        };

	reg_vdd_3v3: regulator-vdd {
		compatible = "regulator-fixed";
		regulator-name = "VDD_3V3";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
	};

	reg_vref_1v8: regulator-adc-vref {
		compatible = "regulator-fixed";
		regulator-name = "vref_1v8";
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <1800000>;
	};

	reg_can1_stby: regulator-can0-stby {
                compatible = "regulator-fixed";
		pinctrl-names = "default";
                pinctrl-0 = <&pinctrl_reg_can1_stby>;
                regulator-name = "can1-stby";
                regulator-min-microvolt = <3300000>;
                regulator-max-microvolt = <3300000>;
                gpio = <&gpio3 27 GPIO_ACTIVE_HIGH>; /* CCM_CLK02 -> GPIO_01 */
                enable-active-high;
        };

        reg_can2_stby: regulator-can1-stby {
                compatible = "regulator-fixed";
                regulator-name = "can2-stby";
                regulator-min-microvolt = <3300000>;
                regulator-max-microvolt = <3300000>;
                gpio = <&pcal6534 15 GPIO_ACTIVE_HIGH>; /* P1_7 -> GPIO_04 */
                enable-active-high;
        };

	usdhc3_pwrseq: usdhc3_pwrseq {
		compatible = "mmc-pwrseq-simple";
		reset-gpios = <&gpio1 10 GPIO_ACTIVE_LOW>;
	};

	reg_usb_otg_vbus: regulator-usb-otg-vbus {
                compatible = "regulator-fixed";
                //pinctrl-names = "default";
                //pinctrl-0 = <&pinctrl_reg_usbotg_vbus>;
                regulator-name = "usb_otg_vbus";
                regulator-min-microvolt = <5000000>;
                regulator-max-microvolt = <5000000>;
                gpio = <&pcal6534 14 GPIO_ACTIVE_HIGH>;
                enable-active-high;
        };

        reg_usb_2_vbus: regulator-usb-2-vbus {
                compatible = "regulator-fixed";
                //pinctrl-names = "default";
                //pinctrl-0 = <&pinctrl_reg_usbotg_vbus>;
                regulator-name = "usb_2_vbus";
                regulator-min-microvolt = <5000000>;
                regulator-max-microvolt = <5000000>;
                gpio = <&pcal6534 13 GPIO_ACTIVE_HIGH>;
                enable-active-high;
        };

	sound-wm8962 {
		compatible = "fsl,imx-audio-wm8962";
		model = "wm8962-audio";
		audio-cpu = <&sai1>;
		audio-codec = <&codec>;
		audio-routing =
			"Headphone Jack", "HPOUTL",
			"Headphone Jack", "HPOUTR",
			"Ext Spk", "SPKOUTL",
			"Ext Spk", "SPKOUTR",
			"AMIC", "MICBIAS",
			"IN3R", "AMIC",
			"IN1R", "AMIC";
	};

	mipi_cmds_ltk080a60a004t: mipi-cmds-ltk080a60a004t {
		alias = <&mipi_cmds_ltk080a60a004t>;
		delay-prepare = <100>;
		delay-unprepare = <2>;
		mipi-cmds-enable = /bits/ 8 <0x40 2>; // DELAY(2)
		mipi-cmds-disable = /bits/ 8 <0x40 50>; // DELAY(50)
		min-hs-clock-multiple = <8>;
		mode-video-hfp-disable;
		mode-video-hsa-disable;
	};

	mipi_cmds_m101nwwb: mipi-cmds-m101nwwb {
                alias = <&mipi_cmds_m101nwwb>;
                mode-video-hbp-disable;
                mode-video-hfp-disable;
                mode-video-hsa-disable;
        };

};

&adc1 {
	vref-supply = <&reg_vref_1v8>;
	status = "okay";
};

&eqos {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_eqos>;
	phy-mode = "rgmii-id";
	phy-handle = <&ethphy1>;
	status = "okay";

	mdio {
		compatible = "snps,dwmac-mdio";
		#address-cells = <1>;
		#size-cells = <0>;

		ethphy1: ethernet-phy@1 {
                        compatible = "ethernet-phy-ieee802.3-c22";
                        reg = <3>;
                        eee-broken-1000t;
                        at803x,hib-disabled;
//			interrupts-extended = <&gpio2 29 GPIO_ACTIVE_LOW>;
			interrupt-parent = <&gpio2>;
			interrupts = <29 IRQ_TYPE_LEVEL_LOW>;
//			interrupt-names = "eth_lpi";
#if 0
                        reset-gpios =<&pcal6534 1 GPIO_ACTIVE_LOW>;
#endif
                };
	};
};

&fec {
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_fec>;
        phy-mode = "rgmii-id";
        phy-handle = <&ethphy2>;
        fsl,magic-packet;
        status = "okay";

        mdio {
                #address-cells = <1>;
                #size-cells = <0>;

                ethphy2: ethernet-phy@2 {
                        compatible = "ethernet-phy-ieee802.3-c22";
                        eee-broken-1000t;
#if 0
                        reset-gpios = <&pcal6534 0 GPIO_ACTIVE_LOW>;
                        reset-assert-us = <10000>;
                        reset-deassert-us = <150000>;
#endif
                        interrupts-extended = <&gpio2 16 IRQ_TYPE_LEVEL_LOW>;
                        reg = <3>;
                };
        };
};


&lpm {
	soc-supply = <&buck1>;
	status = "okay";
};

&lpi2c1 { /* PMIC I2C bus, but the PMIC is on lpi2c2 !!! */
        #address-cells = <1>;
        #size-cells = <0>;
        clock-frequency = <400000>;
        pinctrl-names = "default", "sleep";
        pinctrl-0 = <&pinctrl_lpi2c1>;
        pinctrl-1 = <&pinctrl_lpi2c1>;
        status = "okay";

#ifdef LVDS
	ts_goodix: touchscreen@5d {
                compatible = "goodix,gt9271";
                esd-recovery-timeout-ms = <2000>;
		interrupts-extended = <&pcal6534 23 IRQ_TYPE_EDGE_RISING>;
		interrupt-parent = <&pcal6534>;
                interrupts = <23 IRQ_TYPE_EDGE_RISING>; // P2_7
                irq-gpios = <&pcal6534 23 GPIO_ACTIVE_HIGH>;
                //pinctrl-names = "default";
                //pinctrl-0 = <&pinctrl_ts_lvds_gt911>;
                reg = <0x5d>;
                //reset-gpios = <&gpio2 3 GPIO_ACTIVE_HIGH>;
                status = "okay";
        };
#endif
};

&lpi2c2 {
	#address-cells = <1>;
	#size-cells = <0>;
	clock-frequency = <400000>;
	pinctrl-names = "default", "sleep";
	pinctrl-0 = <&pinctrl_lpi2c2>;
	pinctrl-1 = <&pinctrl_lpi2c2>;
	status = "okay";

	pmic@25 {
		compatible = "nxp,pca9451a";
		reg = <0x25>;
		interrupt-parent = <&pcal6534>;
		interrupts = <11 IRQ_TYPE_EDGE_FALLING>;

		regulators {
			buck1: BUCK1 {
				regulator-name = "BUCK1";
				regulator-min-microvolt = <650000>;
				regulator-max-microvolt = <2237500>;
				regulator-boot-on;
				regulator-always-on;
				regulator-ramp-delay = <3125>;
			};

			buck2: BUCK2 {
				regulator-name = "BUCK2";
				regulator-min-microvolt = <600000>;
				regulator-max-microvolt = <2187500>;
				regulator-boot-on;
				regulator-always-on;
				regulator-ramp-delay = <3125>;
			};

			buck4: BUCK4{
				regulator-name = "BUCK4";
				regulator-min-microvolt = <600000>;
				regulator-max-microvolt = <3400000>;
				regulator-boot-on;
				regulator-always-on;
			};

			buck5: BUCK5{
				regulator-name = "BUCK5";
				regulator-min-microvolt = <600000>;
				regulator-max-microvolt = <3400000>;
				regulator-boot-on;
				regulator-always-on;
			};

			buck6: BUCK6 {
				regulator-name = "BUCK6";
				regulator-min-microvolt = <600000>;
				regulator-max-microvolt = <3400000>;
				regulator-boot-on;
				regulator-always-on;
			};

			ldo1: LDO1 {
				regulator-name = "LDO1";
				regulator-min-microvolt = <1600000>;
				regulator-max-microvolt = <3300000>;
				regulator-boot-on;
				regulator-always-on;
			};

			ldo4: LDO4 {
				regulator-name = "LDO4";
				regulator-min-microvolt = <800000>;
				regulator-max-microvolt = <3300000>;
				regulator-boot-on;
				regulator-always-on;
			};

			ldo5: LDO5 {
				regulator-name = "LDO5";
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <3300000>;
				regulator-boot-on;
				regulator-always-on;
			};
		};
	};

	pcal6534: gpio@22 {
		compatible = "nxp,pcal6534";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_pcal6534>;
		reg = <0x22>;
		vcc-supply = <&reg_vref_1v8>;
		gpio-controller;
		#gpio-cells = <2>;
		interrupt-controller;
		#interrupt-cells = <2>;
		interrupt-parent = <&gpio2>;
		interrupts = <17 IRQ_TYPE_LEVEL_LOW>;
		reset-gpios = <&gpio2 28 GPIO_ACTIVE_LOW>; /* GPIO_IO28 */
		gpio-line-names = "P0_0 ENET2", "P0_1 ENET1", "P0_2 WL_EN",
					"P0_3 WIFI_SDIO_WAKE", "P0_4 BT_EN",
					"P0_5 EMMC_RESET", "P0_6 BT_HOST_WAKE",
					"P0_7 ESPI1_CS1",
					"P1_0 CHARGER_PRESENT", "P1_1 ESPI_ALERT0",
					"P1_2 TEST", "P1_3 ESPI_RESET",
					"P1_4 SD2_WP", "P1_5 USB2_PWR_EN_OC",
					"P1_6 USB1_PWR_EN_OC", "P1_7 GPIO_4",
					"P2_0 LCD0_BCKL_EN", "P2_1 LCD0_VDD_EN",
					"P2_2 CARRIER_STBY", "P2_3 LCD1_BCKL_EN",
					"P2_4 CHARGING", "P2_5 SLEEP",
					"P2_6 BAT_LOW", "P2_7 SMBUS_IRQ",
					"P3_0 GPIO_8", "P3_1 RESET_OUT",
					"P3_2 GPIO_10", "P3_3 GPIO_11",
					"P3_4 PMIC_IRQ", "P3_5 GPIO_13",
					"P3_6 TP33", "P3_7 CARRIER_PWR_ON",
					"P4_0 I2C_HUB_RESET", "P4_1 GPIO_9";
	};

	i2cmuxsom@71 {
                pinctrl-names = "default";
                compatible = "nxp,pca9546";
                reg = <0x71>;
                reset-gpios = <&pcal6534 32 GPIO_ACTIVE_LOW>; /* P4_0 */
                #address-cells = <1>;
                #size-cells = <0>;

                i2cmuxsoma: i2cmuxsom@csi0 {
                        /* CSI0 I2C */
                        clock-frequency = <100000>;
                        reg = <0>;
                        #address-cells = <1>;
                        #size-cells = <0>;
                };

                i2cmuxsomb: i2cmuxsom@lcd {
                        /* LCD I2C */
                        clock-frequency = <100000>;
                        reg = <1>;
                        #address-cells = <1>;
                        #size-cells = <0>;
                };

                i2cmuxsomc: i2cmuxsom@csi1 {
                        /* CSI1 I2C */
                        clock-frequency = <100000>;
                        reg = <2>;
                        #address-cells = <1>;
                        #size-cells = <0>;
                };
        };
};


&i2cmuxsomb { /* LCD I2C */
        i2cmuxsmarc-lcd@73 { /* On SMARC carrier */
                pinctrl-names = "default";
                compatible = "nxp,pca9546";
                reg = <0x73>;
                reset-gpios = <&pcal6534 29 GPIO_ACTIVE_LOW>; /* P3_5 / GPIO_13 */
                #address-cells = <1>;
                #size-cells = <0>;

                i2cmuxlcda: i2cmuxlcd@exp1 {
                        /* EXP1 I2C */
                        clock-frequency = <100000>;
                        reg = <0>;
                        #address-cells = <1>;
                        #size-cells = <0>;
                };

                i2cmuxlcdb: i2cmuxlcd@exp2 {
                        /* EXP2 I2C */
                        clock-frequency = <100000>;
                        reg = <1>;
                        #address-cells = <1>;
                        #size-cells = <0>;
                };

                i2cmuxlcdc: i2cmuxlcd@dsi0 {
                        /* DSI0 I2C */
                        clock-frequency = <100000>;
                        reg = <2>;
                        #address-cells = <1>;
                        #size-cells = <0>;
                };

                i2cmuxlcdd: i2cmuxlcd@dsi1 {
                        /* DSI1 I2C */
                        clock-frequency = <100000>;
                        reg = <3>;
                        #address-cells = <1>;
                        #size-cells = <0>;
                };
        };
};

&i2cmuxlcdc {
#ifdef DSI
	/* 0x5d or 0x14 */
	ts_goodix: touchscreen@14 {
                compatible = "goodix,gt9271";
                esd-recovery-timeout-ms = <2000>;
		interrupts-extended = <&pcal6534 16 IRQ_TYPE_EDGE_RISING>;
		interrupt-parent = <&pcal6534>;
                interrupts = <16 IRQ_TYPE_EDGE_RISING>;
                irq-gpios = <&pcal6534 16 GPIO_ACTIVE_HIGH>;
                pinctrl-names = "default";
                pinctrl-0 = <&pinctrl_ts_dsi_gt911>;
                reg = <0x14>;
                reset-gpios = <&gpio2 3 GPIO_ACTIVE_HIGH>;
                status = "okay";
        };
#endif
#if 0
	ts_lvds_ft5x06: touchscreen@38 {
                //compatible = "edt,ft5x06-ts";
                compatible = "edt,ft7250";
		interrupt-parent = <&pcal6534>;
                interrupts = <16 IRQ_TYPE_EDGE_FALLING>;
                pinctrl-names = "default";
                pinctrl-0 = <&pinctrl_ts_dsi_gt911>;
                reg = <0x38>;
                reset-gpios = <&gpio2 3 GPIO_ACTIVE_LOW>;
                wakeup-gpios = <&pcal6534 16 GPIO_ACTIVE_LOW>;
                status = "okay";
        };

	dsi0_sn65dsi84: dsi0@2c {
                compatible = "ti,sn65dsi84";
                enable-gpios = <&pcal6534 17 GPIO_ACTIVE_HIGH>;
                reg = <0x2c>;
                status = "okay";
        };
#endif

};

&lpi2c3 { /* SM_I2C_GP */
        #address-cells = <1>;
        #size-cells = <0>;
        clock-frequency = <400000>; // 100000 ??
        pinctrl-names = "default", "sleep";
        pinctrl-0 = <&pinctrl_lpi2c3>;
        pinctrl-1 = <&pinctrl_lpi2c3>;
        status = "okay";

        /* On bd-universal-smarc-carrier */
        i2cmuxsmarc-gp@73 {
                compatible = "nxp,pca9546";
                reg = <0x73>;
                reset-gpios = <&gpio2 2 GPIO_ACTIVE_LOW>; /* SMARC GPIO6*/
                #address-cells = <1>;
                #size-cells = <0>;

                i2cmuxsmarcgpa: i2cmuxsmarc-gp@rtc {
                        /* RTC */
                        clock-frequency = <100000>;
                        reg = <0>;
                        #address-cells = <1>;
                        #size-cells = <0>;
                };

                i2cmuxsmarcgpb: i2cmuxsmarc-gp@usb-c {
                        /* USB C */
                        clock-frequency = <100000>;
                        reg = <1>;
                        #address-cells = <1>;
                        #size-cells = <0>;
                };

                i2cmuxsmarcgpc: i2cmuxsmarc-gp@audio {
                        /* audio */
                        clock-frequency = <100000>;
                        reg = <2>;
                        #address-cells = <1>;
                        #size-cells = <0>;
                };

                i2cmuxsmarcgpd: i2cmuxsmarc-gp@pcie {
                        /* pcie */
                        clock-frequency = <100000>;
                        reg = <3>;
                        #address-cells = <1>;
                        #size-cells = <0>;
                };
        };
};

&i2cmuxsmarcgpa {
        rv3028: rtc@52 {
                backup-switchover-dsm;
                #clock-cells = <0>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_rv3028>;
                compatible = "microcrystal,rv3028";
                reg = <0x52>;
		interrupt-parent = <&gpio2>; /* SMARC GPIO12 */
                interrupts = <22 IRQ_TYPE_LEVEL_LOW>;
                wakeup-source;
        };
};

&i2cmuxsmarcgpc {
        codec: wm8962@1a {
                compatible = "wlf,wm8962";
                reg = <0x1a>;
                clocks = <&clk IMX93_CLK_SAI1_GATE>;
                AVDD-supply = <&reg_vref_1v8>;
                CPVDD-supply = <&reg_vref_1v8>;
                DBVDD-supply = <&reg_vdd_3v3>;
                DCVDD-supply = <&reg_vref_1v8>;
                MICVDD-supply = <&reg_vdd_3v3>;
                PLLVDD-supply = <&reg_vref_1v8>;
                SPKVDD1-supply = <&reg_vref_5v0>;
                SPKVDD2-supply = <&reg_vref_5v0>;
                gpio-cfg = <
                        0x0000 /* n/c */
                        0x0000 /* gpio2: */
                        0x0000 /* gpio3: */
                        0x0000 /* n/c */
                        0x8081 /* gpio5:HP detect */
                        0x8095 /* gpio6:Mic detect */
                >;
		gpio-line-names = "N/C", "GPIO2",
				"GPIO3", "N/C",
				"GPIO5:HP detect",
				"GPIO6:Mic detect";
        };
};

&lpuart1 { /* console SER1 */
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart1>;
	status = "okay";
};

&lpuart2 { /* M33 console SER3 */
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart2>;
	status = "okay";
};


#if 0
&lpuart5 {
	/* BT */
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart5>;
	pinctrl-assert-gpios = <&pcal6534 19 GPIO_ACTIVE_HIGH>;
	status = "disabled";

	bluetooth {
		compatible = "nxp,88w8987-bt";
	};
};
#endif

&lpuart6 { /*  SER2 */
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart6>;
	status = "okay";
};

&lpuart8 { /*  SER0 */
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart8>;
	status = "okay";
};

&flexcan1 {
	pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_can1>;
        status = "okay";
        xceiver-supply = <&reg_can1_stby>;
};

&flexcan2 {
	pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_can2>;
        status = "okay";
        xceiver-supply = <&reg_can2_stby>;
};

&tpm1 {
	status = "okay";
};

&tpm3 {
	/* Used for sai1-mclk */
	status = "okay";
};

&tpm5 {
	status = "okay";
};

&tpm6 {
	status = "okay";
};

&usbotg1 {
	dr_mode = "otg";
	hnp-disable;
	srp-disable;
	adp-disable;
	usb-role-switch;
	vbus-supply = <&reg_usb_otg_vbus>;
	disable-over-current;
	samsung,picophy-pre-emp-curr-control = <3>;
	samsung,picophy-dc-vol-level-adjust = <7>;
	status = "okay";
};

&usbotg2 {
        dr_mode = "host";
	vbus-supply = <&reg_usb_2_vbus>;
        disable-over-current;
        samsung,picophy-pre-emp-curr-control = <3>;
        samsung,picophy-dc-vol-level-adjust = <7>;
        status = "okay";
};

&media_blk_ctrl {
        status = "okay";
};

&mu1 {
	status = "okay";
};

&mu2 {
	status = "okay";
};

&sai1 { /* SMARC I2S0 wm8962 */
	#sound-dai-cells = <0>;
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_sai1>;
	assigned-clocks = <&clk IMX93_CLK_SAI1>;
	assigned-clock-parents = <&clk IMX93_CLK_AUDIO_PLL>;
	clocks = <&clk IMX93_CLK_SAI1_IPG>, <&clk IMX93_CLK_DUMMY>,
		<&clk IMX93_CLK_SAI1_GATE>, <&clk IMX93_CLK_DUMMY>,
		<&sai1_pwm_mclk>;
	clock-names = "bus", "mclk0", "mclk1", "mclk2", "mclk3";
	/* wm8962 needs MCLK 14 - 40 MHz */
	assigned-clock-rates = <24000000>;
	/* CPU is master for MCLK, and slave for Bit and SYNC CLKs */
	fsl,sai-mclk-direction-output;
	fsl,sai-asynchronous;
	status = "okay";
};

#if 0
&sai3 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_sai3>;
	pinctrl-assert-gpios = <&pcal6534 22 GPIO_ACTIVE_LOW>;
	assigned-clocks = <&clk IMX93_CLK_SAI3>;
	assigned-clock-parents = <&clk IMX93_CLK_AUDIO_PLL>;
	assigned-clock-rates = <12288000>;
	fsl,sai-mclk-direction-output;
	fsl,sai-synchronous-rx;
	status = "okay";
};
#endif

&usdhc1 {
	pinctrl-names = "default", "state_100mhz", "state_200mhz";
	pinctrl-0 = <&pinctrl_usdhc1>;
	pinctrl-1 = <&pinctrl_usdhc1>;
	pinctrl-2 = <&pinctrl_usdhc1>;
	bus-width = <8>;
	non-removable;
	status = "okay";
};

&usdhc2 {
	pinctrl-names = "default", "state_100mhz", "state_200mhz";
	pinctrl-0 = <&pinctrl_usdhc2>, <&pinctrl_usdhc2_gpio>;
	pinctrl-1 = <&pinctrl_usdhc2>, <&pinctrl_usdhc2_gpio>;
	pinctrl-2 = <&pinctrl_usdhc2>, <&pinctrl_usdhc2_gpio>;
	cd-gpios = <&gpio3 00 GPIO_ACTIVE_LOW>;
	vmmc-supply = <&reg_usdhc2_vmmc>;
	bus-width = <4>;
	status = "okay";
	no-sdio;
	no-mmc;
};

#if 0
&usdhc3 {
	pinctrl-names = "default", "state_100mhz", "state_200mhz";
	pinctrl-0 = <&pinctrl_usdhc3>;
	pinctrl-1 = <&pinctrl_usdhc3>;
	pinctrl-2 = <&pinctrl_usdhc3>;
	mmc-pwrseq = <&usdhc3_pwrseq>;
	pinctrl-assert-gpios = <&pcal6534 13 GPIO_ACTIVE_HIGH>;
	bus-width = <4>;
	keep-power-in-suspend;
	non-removable;
	wakeup-source;
	fsl,sdio-async-interrupt-enabled;
	status = "okay";

	wifi_wake_host {
		compatible = "nxp,wifi-wake-host";
		interrupt-parent = <&pcal6534>;
		/* pcal6534 IO expander limitation: only support edge-triggered irq */
		interrupts = <5 IRQ_TYPE_EDGE_FALLING>;
		interrupt-names = "host-wake";
	};
};
#endif

#ifdef DSI
&dphy {
        status = "okay";
};

&dsi {
	status = "okay";

        fb_mipi: panel@0 {
                backlight = <&dsi_backlight>;
                bits-per-color = <8>;
                bridge-de-active = <0>;
                bus-format = "rgb888";
                clocks = <&clk IMX93_CLK_MIPI_TEST_BYTE>,
                        <&clk IMX93_CLK_MEDIA_DISP_PIX>;
                clock-names = "mipi_clk", "pixel_clock";
                compatible = "panel,common";
                dsi-format = "rgb888";
                dsi-lanes = <4>;

		/* This tends to be done by Boundarys U-boot */
#if DSI == 10
		mipi-cmds = <&mipi_cmds_m101nwwb>;
#else
		mipi-cmds = <&mipi_cmds_ltk080a60a004t>;
#endif

                mode-skip-eot;
                mode-video;
                mode-video-burst;
                panel-height-mm = <136>;
                panel-width-mm = <217>;

		/* used by dsi_to_lvds node ?? !!! */
//		pinctrl-names = "sn65dsi83";
//		pinctrl-0 = <&pinctrl_i2cmuxlcdc_sn65dsi83>;

                power-supply = <&reg_vref_5v0>;
                reg = <0>;
                spwg;

#if DSI == 10
                sn65dsi83 = <&dsi_to_lvds>;
#endif

                display-timings {
#if DSI == 10
                        t_dsi: t-dsi-default {
                                /* m101nwwb by default */
                                clock-frequency = <66000000>;
                                hactive = <1280>;
                                vactive = <800>;
                                hback-porch = <5>;
                                hfront-porch = <123>;
                                vback-porch = <3>;
                                vfront-porch = <24>;
                                hsync-len = <1>;
                                vsync-len = <1>;
                                hsync-active = <0>;
                                vsync-active = <0>;
                                de-active = <1>;
                        };
#else
			t_dsi: t-dsi-default {
				/* ltk080a60a004t */
				clock-frequency = <120000000>;
				hactive = <1200>;
				vactive = <1920>;
				hback-porch = <60>;
				vback-porch = <25>;
				hfront-porch = <42>;
				vfront-porch = <35>;
				hsync-len = <2>;
				vsync-len = <1>;
                                hsync-active = <0>;
                                vsync-active = <0>;
			};
#endif
        	};
#if DSI == 10
		dsi_to_lvds: dsi-to-lvds {
                        enable-gpios = <&pcal6534 17 GPIO_ACTIVE_HIGH>;
                        i2c-address = <0x2c>;
                        i2c-bus = <&i2cmuxlcdc>;
                        interrupts-extended = <&pcal6534 18 (IRQ_TYPE_EDGE_RISING | GPIO_PULL_DOWN)>;
                        status = "okay";
                };
#endif

		port {
                        panel_in: endpoint {
                                remote-endpoint = <&dsi_out>;
                        };
                };
	};

	ports {
                port@1 {
                        reg = <1>;

                        dsi_out: endpoint {
                                remote-endpoint = <&panel_in>;
                        };
                };
        };
};

&lcdif {
        assigned-clock-rates = <484000000>, <121000000>, <400000000>, <133333333>;
	status = "okay";
};

#endif

#ifdef LVDS
&dphy {
        status = "disabled";
};

&dsi {
        status = "disabled";
};

&lcdif {
	assigned-clock-rates = <498000000>, <71142857>, <400000000>, <133333333>;
	status = "okay";
};

&ldb {
	status = "okay";

	lvds-channel@0 {
		status = "okay";

#if 0
		display-timings {
                        t_lvds: t_lvds_default {
                                /* m101nwwb by default */
                                clock-frequency = <74250000>;
                                hactive = <1280>;
                                vactive = <800>;
                                hback-porch = <5>;
                                hfront-porch = <123>;
                                vback-porch = <3>;
                                vfront-porch = <24>;
                                hsync-len = <1>;
                                vsync-len = <1>;
                        };
                };
#endif

		port@1 {
			reg = <1>;

			lvds_out: endpoint {
                                remote-endpoint = <&panel_lvds_in>;
                        };
		};
	};

};

&ldb_phy {
	status = "okay";
};

#endif

&iomuxc {
	pinctrl_leds: ledsgrp {
		fsl,pins = <
			MX93_PAD_UART2_RXD__TPM1_CH2				0x02
		>;
	};

	/* DSI */
	pinctrl_backlight_0: backlight_0 {
		fsl,pins = <
			MX93_PAD_GPIO_IO26__TPM5_CH3				0x02
		>;
	};

	pinctrl_backlight_1: backlight_1 {
		fsl,pins = <
			MX93_PAD_GPIO_IO23__TPM6_CH1				0x02
		>;
	};

	pinctrl_eqos: eqosgrp {
		fsl,pins = <
			MX93_PAD_ENET1_MDC__ENET_QOS_MDC			0x57e
			MX93_PAD_ENET1_MDIO__ENET_QOS_MDIO			0x57e
			MX93_PAD_ENET1_RD0__ENET_QOS_RGMII_RD0			0x57e
			MX93_PAD_ENET1_RD1__ENET_QOS_RGMII_RD1			0x57e
			MX93_PAD_ENET1_RD2__ENET_QOS_RGMII_RD2			0x57e
			MX93_PAD_ENET1_RD3__ENET_QOS_RGMII_RD3			0x57e
			MX93_PAD_ENET1_RXC__CCM_ENET_QOS_CLOCK_GENERATE_RX_CLK	0x5fe
			MX93_PAD_ENET1_RX_CTL__ENET_QOS_RGMII_RX_CTL		0x57e
			MX93_PAD_ENET1_TD0__ENET_QOS_RGMII_TD0			0x57e
			MX93_PAD_ENET1_TD1__ENET_QOS_RGMII_TD1			0x57e
			MX93_PAD_ENET1_TD2__ENET_QOS_RGMII_TD2			0x57e
			MX93_PAD_ENET1_TD3__ENET_QOS_RGMII_TD3			0x57e
			MX93_PAD_ENET1_TXC__CCM_ENET_QOS_CLOCK_GENERATE_TX_CLK	0x5fe
			MX93_PAD_ENET1_TX_CTL__ENET_QOS_RGMII_TX_CTL		0x57e
			MX93_PAD_GPIO_IO29__GPIO2_IO29                          0x31e
		>;
	};

	pinctrl_fec: fecgrp {
                fsl,pins = <
                        MX93_PAD_ENET2_MDC__ENET1_MDC                           0x57e
                        MX93_PAD_ENET2_MDIO__ENET1_MDIO                         0x57e
                        MX93_PAD_ENET2_RD0__ENET1_RGMII_RD0                     0x57e
                        MX93_PAD_ENET2_RD1__ENET1_RGMII_RD1                     0x57e
                        MX93_PAD_ENET2_RD2__ENET1_RGMII_RD2                     0x57e
                        MX93_PAD_ENET2_RD3__ENET1_RGMII_RD3                     0x57e
                        MX93_PAD_ENET2_RXC__ENET1_RGMII_RXC                     0x57e
                        MX93_PAD_ENET2_RX_CTL__ENET1_RGMII_RX_CTL               0x57e
                        MX93_PAD_ENET2_TD0__ENET1_RGMII_TD0                     0x57e
                        MX93_PAD_ENET2_TD1__ENET1_RGMII_TD1                     0x57e
                        MX93_PAD_ENET2_TD2__ENET1_RGMII_TD2                     0x57e
                        MX93_PAD_ENET2_TD3__ENET1_RGMII_TD3                     0x57e
                        MX93_PAD_ENET2_TXC__ENET1_RGMII_TXC                     0x57e
                        MX93_PAD_ENET2_TX_CTL__ENET1_RGMII_TX_CTL               0x57e
                        MX93_PAD_GPIO_IO16__GPIO2_IO16                          0x31e
                >;
        };

	pinctrl_lpi2c1: lpi2c1grp {
		fsl,pins = <
			MX93_PAD_I2C1_SCL__LPI2C1_SCL			0x40000b9e
			MX93_PAD_I2C1_SDA__LPI2C1_SDA			0x40000b9e
		>;
	};

	pinctrl_lpi2c2: lpi2c2grp {
		fsl,pins = <
			MX93_PAD_I2C2_SCL__LPI2C2_SCL			0x40000b9e
			MX93_PAD_I2C2_SDA__LPI2C2_SDA			0x40000b9e
		>;
	};

	pinctrl_lpi2c3: lpi2c3grp {
                fsl,pins = <
                        MX93_PAD_GPIO_IO00__LPI2C3_SDA                  0x40000b9e
                        MX93_PAD_GPIO_IO01__LPI2C3_SCL                  0x40000b9e
                        MX93_PAD_GPIO_IO02__GPIO2_IO02                  0x31e
                >;
        };

	pinctrl_reg_can1_stby: regcan1stbygrp {
		fsl,pins = <
			MX93_PAD_CCM_CLKO2__GPIO3_IO27			0x31e
		>;
	};

	pinctrl_rv3028: rv3028grp {
		fsl,pins = <
			MX93_PAD_GPIO_IO22__GPIO2_IO22			0x31e
		>;
	};

	pinctrl_can1: can1grp {
		fsl,pins = <
			MX93_PAD_PDM_CLK__CAN1_TX			0x139e
			MX93_PAD_PDM_BIT_STREAM0__CAN1_RX		0x139e
		>;
	};

	pinctrl_can2: can2grp {
		fsl,pins = <
			MX93_PAD_GPIO_IO25__CAN2_TX			0x139e
			MX93_PAD_GPIO_IO27__CAN2_RX			0x139e
		>;
	};

	pinctrl_pcal6534: pcal6534grp {
		fsl,pins = <
			MX93_PAD_GPIO_IO28__GPIO2_IO28                  0x31e
                        MX93_PAD_GPIO_IO17__GPIO2_IO17                  0x31e
		>;
	};

	pinctrl_ts_dsi_gt911: tsdsigt911grp {
		fsl,pins = <
			MX93_PAD_GPIO_IO03__GPIO2_IO03			0x31e
		>;
	};

	pinctrl_uart1: uart1grp {
		fsl,pins = <
			MX93_PAD_UART1_RXD__LPUART1_RX			0x31e
			MX93_PAD_UART1_TXD__LPUART1_TX			0x31e
		>;
	};

	pinctrl_uart2: uart2grp {
		fsl,pins = <
			MX93_PAD_UART2_RXD__LPUART2_RX			0x31e
			MX93_PAD_UART2_TXD__LPUART2_TX			0x31e
		>;
	};

	pinctrl_uart5: uart5grp {
		fsl,pins = <
			MX93_PAD_DAP_TDO_TRACESWO__LPUART5_TX	0x31e
			MX93_PAD_DAP_TDI__LPUART5_RX		0x31e
			MX93_PAD_DAP_TMS_SWDIO__LPUART5_RTS_B	0x31e
			MX93_PAD_DAP_TCLK_SWCLK__LPUART5_CTS_B	0x31e
		>;
	};

	pinctrl_uart6: uart6grp {
		fsl,pins = <
			MX93_PAD_GPIO_IO05__LPUART6_RX			0x3fe /* full drive strength was needed ?? */
			MX93_PAD_GPIO_IO04__LPUART6_TX			0x3fe
		>;
	};

	pinctrl_uart8: uart8grp {
		fsl,pins = <
			MX93_PAD_GPIO_IO13__LPUART8_RX			0x31e
			MX93_PAD_GPIO_IO12__LPUART8_TX			0x31e
			MX93_PAD_GPIO_IO14__LPUART8_CTS_B		0x31e
			MX93_PAD_GPIO_IO15__LPUART8_RTS_B		0x31e
		>;
	};

	pinctrl_usdhc1: usdhc1grp {
		fsl,pins = <
			MX93_PAD_SD1_CLK__USDHC1_CLK		0x15fe
			MX93_PAD_SD1_CMD__USDHC1_CMD		0x13fe
			MX93_PAD_SD1_DATA0__USDHC1_DATA0	0x13fe
			MX93_PAD_SD1_DATA1__USDHC1_DATA1	0x13fe
			MX93_PAD_SD1_DATA2__USDHC1_DATA2	0x13fe
			MX93_PAD_SD1_DATA3__USDHC1_DATA3	0x13fe
			MX93_PAD_SD1_DATA4__USDHC1_DATA4	0x13fe
			MX93_PAD_SD1_DATA5__USDHC1_DATA5	0x13fe
			MX93_PAD_SD1_DATA6__USDHC1_DATA6	0x13fe
			MX93_PAD_SD1_DATA7__USDHC1_DATA7	0x13fe
			MX93_PAD_SD1_STROBE__USDHC1_STROBE	0x15fe
		>;
	};

	pinctrl_reg_usdhc2_vmmc: regusdhc2vmmcgrp {
		fsl,pins = <
			MX93_PAD_SD2_RESET_B__GPIO3_IO07	0x31e
		>;
	};

	pinctrl_usdhc2_gpio: usdhc2gpiogrp {
		fsl,pins = <
			MX93_PAD_SD2_CD_B__GPIO3_IO00		0x31e
		>;
	};

	pinctrl_usdhc2: usdhc2grp {
		fsl,pins = <
			MX93_PAD_SD2_CLK__USDHC2_CLK		0x15fe
			MX93_PAD_SD2_CMD__USDHC2_CMD		0x13fe
			MX93_PAD_SD2_DATA0__USDHC2_DATA0	0x13fe
			MX93_PAD_SD2_DATA1__USDHC2_DATA1	0x13fe
			MX93_PAD_SD2_DATA2__USDHC2_DATA2	0x13fe
			MX93_PAD_SD2_DATA3__USDHC2_DATA3	0x13fe
			MX93_PAD_SD2_VSELECT__USDHC2_VSELECT	0x51e
		>;
	};

	pinctrl_usdhc3: usdhc3grp {
		fsl,pins = <
			MX93_PAD_SD3_CLK__USDHC3_CLK			0x15fe
			MX93_PAD_SD3_CMD__USDHC3_CMD			0x13fe
			MX93_PAD_SD3_DATA0__USDHC3_DATA0		0x13fe
			MX93_PAD_SD3_DATA1__USDHC3_DATA1        	0x13fe
			MX93_PAD_SD3_DATA2__USDHC3_DATA2        	0x13fe
			MX93_PAD_SD3_DATA3__USDHC3_DATA3        	0x13fe
			MX93_PAD_PDM_BIT_STREAM1__GPIO1_IO10            0x31e
		>;
	};

	pinctrl_sai1: sai1grp {
		fsl,pins = <
			MX93_PAD_SAI1_TXFS__SAI1_TX_SYNC		0x31e
			MX93_PAD_SAI1_TXC__SAI1_TX_BCLK			0x31e
			MX93_PAD_GPIO_IO24__TPM3_CH3			0x02
			/* MX93_PAD_UART2_RXD__SAI1_MCLK		0x30e */
			/* MX93_PAD_UART2_RXD__TPM1_CH2			0x02 */
			MX93_PAD_SAI1_TXD0__SAI1_TX_DATA00		0x31e
			MX93_PAD_SAI1_RXD0__SAI1_RX_DATA00		0x31e
		>;
	};

	pinctrl_sai3: sai3grp {
		fsl,pins = <
			MX93_PAD_GPIO_IO12__SAI3_RX_SYNC		0x31e
			MX93_PAD_GPIO_IO18__SAI3_RX_BCLK		0x31e
			MX93_PAD_GPIO_IO17__SAI3_MCLK			0x31e
			MX93_PAD_GPIO_IO19__SAI3_TX_DATA00		0x31e
			MX93_PAD_GPIO_IO20__SAI3_RX_DATA00		0x31e
		>;
	};
};

&epxp {
	status = "okay";
};
